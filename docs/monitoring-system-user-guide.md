# 性能监控系统使用手册

## 1. 系统概述

性能监控系统是聚财众发平台的重要组成部分，用于实时监控系统的各项关键性能指标，包括API响应时间、数据库查询性能、前端页面加载速度等。系统通过自动化的监控和告警机制，确保平台的稳定性和高性能。

## 2. 系统架构

### 2.1 技术组件
- **Express Middleware**: 用于收集API请求响应时间
- **Winston**: 用于日志记录和分析
- **Nodemailer**: 用于发送告警邮件
- **ECharts**: 用于数据可视化
- **PM2 Cron**: 用于定时任务执行

### 2.2 监控维度
1. API性能监控
2. 数据库性能监控
3. 前端性能监控
4. 系统资源监控

## 3. 功能特性

### 3.1 实时监控
- API响应时间实时监控
- 数据库查询性能实时监控
- 前端页面加载性能实时监控

### 3.2 告警机制
- 多级告警（警告/严重）
- 多渠道通知（邮件/Webhook）
- 告警抑制（避免重复告警）

### 3.3 数据可视化
- 实时性能仪表板
- 历史性能趋势图表
- 性能报告生成

### 3.4 日志分析
- 性能日志收集
- 错误日志分析
- 慢查询识别

## 4. 使用指南

### 4.1 访问监控仪表板
1. 打开浏览器访问 `http://localhost:3001/api/monitoring/dashboard`
2. 查看系统性能概览
3. 切换不同标签页查看详细性能数据

### 4.2 查看实时性能数据
- **概览页**: 显示系统关键性能指标的当前状态
- **API性能页**: 显示各API端点的响应时间和错误率
- **数据库性能页**: 显示各类数据库查询的执行时间和慢查询统计
- **前端性能页**: 显示各页面的加载时间和用户访问统计

### 4.3 告警配置
告警配置文件位于 `config/alertConfig.js`，可以配置以下参数：
- 各项性能指标的告警阈值
- 告警通知方式（邮件、短信、Webhook）
- 告警抑制规则

## 5. 告警机制

### 5.1 告警级别
- **警告(WARNING)**: 性能指标接近阈值，需要关注
- **严重(CRITICAL)**: 性能指标严重超标，需要立即处理

### 5.2 告警阈值
| 监控项 | 警告阈值 | 严重阈值 |
|--------|----------|----------|
| API响应时间 | 1000ms | 5000ms |
| 数据库查询时间 | 500ms | 2000ms |
| 页面加载时间 | 3000ms | 10000ms |
| 错误率 | 1.0% | 5.0% |
| 慢查询数量 | 10个 | 50个 |

### 5.3 通知方式
- **邮件通知**: 发送到配置的邮箱列表
- **Webhook通知**: 发送到配置的Webhook地址（如Slack）
- **短信通知**: 发送到配置的手机号码（需要配置短信服务）

## 6. 日志文件说明

### 6.1 性能日志
- `logs/performance.log`: API性能日志
- `logs/db-performance.log`: 数据库性能日志
- `logs/frontend-performance.log`: 前端性能日志
- `logs/user-interaction.log`: 用户交互日志

### 6.2 告警日志
- `logs/alerts.log`: 系统告警日志

## 7. 系统维护

### 7.1 日志清理
定期清理过期的日志文件，避免占用过多磁盘空间。

### 7.2 阈值调整
根据实际业务需求和系统表现，适时调整告警阈值。

### 7.3 通知配置
根据团队组织结构，更新告警通知的接收人列表。

## 8. 故障排除

### 8.1 监控数据不更新
1. 检查PM2服务是否正常运行
2. 检查日志文件是否有错误信息
3. 重启相关服务

### 8.2 告警不触发
1. 检查告警配置是否正确
2. 检查通知服务配置是否正确
3. 检查日志文件确认是否有告警记录

### 8.3 仪表板无法访问
1. 检查网络连接
2. 检查服务器是否正常运行
3. 检查防火墙设置

## 9. 最佳实践

### 9.1 性能优化建议
1. 定期分析慢查询日志，优化数据库查询
2. 监控API响应时间，识别性能瓶颈
3. 优化前端资源加载，提升页面加载速度

### 9.2 告警管理建议
1. 合理设置告警阈值，避免误报和漏报
2. 定期审查告警规则，确保其有效性
3. 建立告警处理流程，确保问题及时解决

## 10. 技术支持

如遇到技术问题，请联系系统管理员或查看相关技术文档。