# Qoder 系统总控任务流使用指南

## 🎯 系统概述

Qoder 系统总控任务流是一个集成化的自动化任务执行系统，可以通过简单的中文指令一键执行复杂的系统任务链，包括构建、部署、数据库同步、文档更新等。

## 🚀 快速开始

### 1. 使用 npm 脚本执行

```bash
# 执行系统总控任务
npm run qoder "执行系统总控任务"

# 检查所有模块状态
npm run qoder "检查所有模块状态"

# 同步数据库并更新文档
npm run qoder "同步数据库并更新文档"
```

### 2. 直接执行脚本

```bash
# 执行系统总控任务
node scripts/qoder-cli.js "执行系统总控任务"

# 检查所有模块状态
node scripts/qoder-cli.js "检查所有模块状态"

# 同步数据库并更新文档
node scripts/qoder-cli.js "同步数据库并更新文档"
```

## 🧩 支持的指令

### 1. 执行系统总控任务
执行完整的系统构建、部署和同步任务，包括：
- 前端构建和部署
- PM2服务重启
- API可用性验证
- 数据库Schema同步
- 字段注释生成
- 命名规范检查
- API文档生成

### 2. 检查所有模块状态
检查系统各模块运行状态，包括：
- PM2服务状态
- API接口可用性
- 数据库连接状态
- 文档同步状态

### 3. 同步数据库并更新文档
同步数据库结构并更新相关文档，包括：
- 数据库Schema同步
- 字段注释生成
- 命名规范检查
- API文档更新

## ⚙️ 任务流详情

### 完整任务链执行步骤

1. **环境准备**
   - 切换到工作目录
   - 检查构建状态

2. **构建与部署**
   - 执行 npm install（如需要）
   - 执行构建命令
   - 部署到public目录
   - 重启PM2服务

3. **验证与同步**
   - 验证API可用性
   - 同步数据库Schema
   - 生成字段注释
   - 检查命名规范

4. **文档更新**
   - 生成API文档
   - 记录执行日志

## 📁 系统架构

```
scripts/
├── system-control-panel.js    # 核心任务流实现
├── qoder-cli.js              # 命令行接口
└── ...                       # 其他自动化脚本

docs/
└── QODER_SYSTEM_CONTROL.md   # 本使用文档

logs/
└── system-control.log        # 执行日志
```

## 📊 执行报告

每次执行任务流都会生成详细的执行报告，包括：
- 执行时间戳
- 各步骤执行状态
- 错误信息（如有）
- 最终执行结果

日志文件位置：`logs/system-control.log`

## 🔧 故障排除

### 常见问题

1. **指令执行失败**
   - 检查指令是否正确输入
   - 确认系统环境是否正常
   - 查看详细错误日志

2. **构建失败**
   - 检查网络连接
   - 确认依赖包是否完整
   - 查看构建错误信息

3. **部署失败**
   - 检查PM2服务状态
   - 确认端口是否被占用
   - 查看部署日志

### 日志查看

```bash
# 查看系统总控日志
tail -f logs/system-control.log

# 查看PM2日志
npm run pm2-logs
```

## 🔄 自动化集成

### 定时执行

可以将系统总控任务集成到定时任务中：

```bash
# 每天凌晨2点执行系统检查
0 2 * * * cd /path/to/project && npm run qoder "检查所有模块状态"
```

### CI/CD 集成

在持续集成流程中使用：

```bash
# 在部署流程中执行
npm run qoder "执行系统总控任务"
```

## 🛡️ 安全说明

1. **权限控制**
   - 确保脚本具有适当执行权限
   - 避免在生产环境执行破坏性操作

2. **数据保护**
   - 执行前备份重要数据
   - 确认操作不会影响生产数据

3. **日志安全**
   - 敏感信息不会记录到日志中
   - 日志文件权限应适当设置

## 📈 系统优势

1. **简化操作**: 通过简单的中文指令执行复杂任务
2. **自动化**: 全流程自动化，减少人工干预
3. **一致性**: 标准化流程确保每次执行结果一致
4. **可追溯**: 完整的日志记录便于问题排查
5. **可扩展**: 模块化设计便于功能扩展

## 📅 后续优化

1. **增强监控**: 添加更详细的系统监控
2. **扩展指令**: 支持更多中文指令
3. **Web界面**: 提供图形化操作界面
4. **通知机制**: 添加执行完成通知功能
5. **并行执行**: 优化任务执行效率

---
*文档更新时间: 2025-10-24*
*Qoder 系统总控版本: 1.0.0*